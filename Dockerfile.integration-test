FROM --platform=${BUILDPLATFORM:-linux/amd64} bats/bats:1.13.0@sha256:6e4b9369468b7f3fd8f402ac6cc8ea7b2e4903eae28d08785f31a0245eb51a44

ARG KUBECTL_VERSION=v1.35.0
ARG GRPC_HEALTH_PROBE_VERSION=v0.4.44
ARG YQ_VERSION=v4.52.2

# Add packages
RUN apk upgrade --no-cache --no-progress \  
&& apk --no-cache --no-progress add curl git bash \  
&& apk del --no-cache --no-progress apk-tools alpine-keys

# Install kubectl binary
RUN curl -fLO "https://dl.k8s.io/release/${KUBECTL_VERSION}/bin/linux/amd64/kubectl" && \
    chmod +x kubectl && \
    mv kubectl /usr/local/bin/

# Install GRPC Health Probe
RUN curl -fL https://github.com/grpc-ecosystem/grpc-health-probe/releases/download/${GRPC_HEALTH_PROBE_VERSION}/grpc_health_probe-linux-amd64 -o /usr/local/bin/grpc_health_probe && \
	chmod +x /usr/local/bin/grpc_health_probe

# Install yq binary
RUN curl -fL https://github.com/mikefarah/yq/releases/download/${YQ_VERSION}/yq_linux_amd64 -o /usr/local/bin/yq && \
	chmod +x /usr/local/bin/yq