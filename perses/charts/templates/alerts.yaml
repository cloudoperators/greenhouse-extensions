{{ if .Values.perses.serviceMonitor.selfMonitor }}
{{ $root := . }}
{{- range $path, $bytes := .Files.Glob "alerts/*.yaml" }}
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: {{ printf "%s-%s" $root.Release.Name ($path | replace ".yaml" "" | replace "/" "-" | trunc 63) }}
  labels:
     {{- include "perses.labels" $root | nindent 4 }}
     {{- if not (empty $root.Values.perses.serviceMonitor.labels)}}
     {{- with $root.Values.perses.serviceMonitor.labels }}
     {{- toYaml . | nindent 4 }}
     {{- end }}
     {{- end }}
spec:
{{ tpl (printf "%s" $bytes) $root | indent 2 }}
{{- end }}
{{- end }}