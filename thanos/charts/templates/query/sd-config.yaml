{{- if .Values.thanos.query.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "release.name" . }}-sd-config
  labels:  
    {{- include "plugin.labels" . | nindent 4 }}  
    {{- include "thanos.labels" . | nindent 4 }}  
    {{- if .Values.thanos.query.deploymentLabels }}  
    {{ toYaml .Values.thanos.query.deploymentLabels | nindent 4 }}  
    {{- end }}
data:
  endpoint-targets.yaml: |-
    endpoints:
{{- /* Technically it is possible to add stores and have the default stores all together.*/}}
{{- if (empty .Values.thanos.query.stores) }}
{{- range .Values.thanos.query.stores }}
      - address: "{{ . }}"
{{- end -}}
{{- end -}}
{{- else }}
      - address: "prometheus-operated:10901"
      - address: "{{ include "release.name" . }}-store:{{ default "10901" .Values.thanos.grpcAddress }}"
{{- end }}
{{- end }}